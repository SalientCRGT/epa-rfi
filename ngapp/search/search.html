<div class="container">
    <h1 class="text-primary">
        Facilities Registry System
        <hr class="animated slideInLeft">
    </h1>
    <form ng-submit="update(state)" class="navbar-form">
        <select class="form-control" ng-model="state">
            <option value="VA">Virginia</option>
            <option value="MD">Maryland</option>
            <option value="NC">North Carolina</option>
        </select>
        <button class="btn navbar-btn navbar-right" type="submit">
            Update
        </button>    
     </form>

    <form ng-submit="search()" class="collapse in">
        <p class="text-right">
            <a href ng-click="toggleForm()">Advanced Search <i class="fa fa-caret-right"></i></a>
        </p>
        <div class="form-group">
            <div class="input-group">
                <input type="text" ng-model="searchParameters.q" class="form-control" placeholder="search the repository" autofocus />
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit">
                        <i class="fa fa-search" ng-class="{'fa-spin': facilities.$resolved == false}"></i> Search
                    </button>
                </span>
            </div>
        </div>
    </form>

    <form ng-submit="search()" class="form-horizontal collapse">
        <p>
            <a href ng-click="toggleForm()"><i class="fa fa-caret-left"></i> Basic Search</a>
        </p>
        <div class="form-group">
            <label for="primaryName" class="col-md-2 control-label">Name</label>
            <div class="col-md-4">
                <input id="primaryName" type="text" ng-model="searchParameters.primaryName" class="form-control">
            </div>
            <label for="locationAddress" class="col-md-2 control-label">Address</label>
            <div class="col-md-4">
                <input id="locationAddress" type="text" ng-model="searchParameters.locationAddress" class="form-control">
            </div>
        </div>
        <div class="form-group">
            <label for="cityName" class="col-md-2 control-label">City</label>
            <div class="col-md-4">
                <input id="cityName" type="text" ng-model="searchParameters.cityName" class="form-control">
            </div>
            <label for="stateName" class="col-md-2 control-label">State</label>
            <div class="col-md-4">
                <input id="stateName" type="text" ng-model="searchParameters.stateName" class="form-control">
            </div>
        </div>
        <div class="form-group">
            <label for="postalCode" class="col-md-2 control-label">Zip</label>
            <div class="col-md-4">
                <input id="postalCode" type="text" ng-model="searchParameters.postalCode" class="form-control">
            </div>
            <div class="col-md-offset-2 col-md-4 hidden-xs hidden-sm">
                <button class="btn btn-primary" type="submit">
                    <i class="fa fa-search" ng-class="{'fa-spin': facilities.$resolved == false}"></i> Search
                </button>
            </div>
        </div>
        <div class="hidden-md hidden-lg form-group">
            <div class="col-xs-12">
                <button class="btn btn-primary btn-block" type="submit">
                    <i class="fa fa-search" ng-class="{'fa-spin': facilities.$resolved == false}"></i> Search
                </button>
            </div>
        </div>
        <div class="form-group">
            <label for="postalCode" class="col-md-2 control-label">
                JSON API URL
            </label>
            <div class="col-md-10">
                <div class="well well-sm">
                    <a ng-href="{{requestUrl()}}" target="_blank">{{requestUrl()}}</a>
                </div>
            </div>
        </div>
    </form>
    <table class="table table-hover">
        <caption class="text-right">Row Count: {{facilities.$rowCount}}</caption>
        <thead>
            <tr>
                <th>Name</th>
                <th>Federal Agency</th>
                <th>Site Type</th>
                <th colspan="2">Address</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="f in facilities">
                <td ng-if="!f.frsFacilityDetailReportUrl">{{f.primaryName}}</td>
                <td>
                    <a href="{{f.frsFacilityDetailReportUrl}}" target="_blank" title="Detail Report Available">{{f.primaryName}}</a>
                </td>
                <td>{{f.federalAgencyName != '' ? f.federalAgencyName : 'N/A' }}</td>
                <td>{{f.siteTypeName}}</td>
                <td>
                    <address>
                         {{f.locationAddress}}<br>
                         {{f.cityName}}, {{f.stateCode}} {{f.postalCode}}
                    </address>
                </td>
                <td style="white-space: nowrap">
                    <a title="Map by Address" href="http://maps.google.com/?q={{f.locationAddress}} {{f.cityName}} {{f.stateName}} {{f.postalCode}}" target="_blank">
                        <i class="fa fa-globe fa-lg fa-fw"></i>
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
    <div ng-if="facilities.$code!='success' && !facilities.length && facilities.$resolved===true" class="text-muted">
        <em>No results found</em>
    </div>
    <div ng-if="facilities.$code=='error'" class="text-danger">
        <strong>Error: </strong>{{facilities.$msg}}
    </div>
    <nav ng-if="pages.length" class="text-center" >
        <ul class="pagination">
            <li ng-class="{'disabled': pager.page == 1}">
                <a href aria-label="Previous" ng-click="search(pager.page - 1)">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li ng-repeat="page in pages" ng-class="{'active': page == pager.page}">
                <a href ng-click="search(page)">{{page}}</a>
            </li>
            <li>
                <a href aria-label="Previous" ng-click="search(pager.page + 1)">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

</div>
